# Authentication & Organization Flow (MVP)

This MVP showcases two self-service paths: create a new organization or join an existing one seeded in the database. The flow emphasizes multi-tenant boundaries without subdomains.

---

## Registration

1. **Entry options**
   - *Create new organization*: user supplies name, email, password, and new organization name (future-friendly plan tier defaulting to Free). Backend creates the org, seeds defaults, and links the user as owner.
   - *Join existing organization*: user fills the same credentials plus selects an organization from a dropdown (all orgs listed) and chooses a starting role (owner/admin/manager/agent/viewer). We create/attach the user and mark membership active immediately.
2. **Post-registration**
   - User auto-logs in and is redirected to organization confirmation.
   - If they belong to only one org, we skip further choice; session stores `tenant_id` and they land on dashboard.

## Login

1. Standard email/password handled via Fortify.
2. After auth:
   - **Single membership** → set tenant id in session and redirect to dashboard.
   - **Multiple memberships** → show “Choose Organization” view listing memberships with role badges; selecting one posts to `/orgs/switch` and sets the tenant.

## Session & Middleware

- `SetOrganizationContext` middleware reads `session('tenant_id')`.
- Missing tenant id triggers redirect to org-selection (unless user is on registration/public routes).
- All tenant-aware queries use `ScopedByOrganization` or `forOrganization()` helper to scope data.

## Future Enhancements (out of scope now)

- Invitation tokens/approval workflows for real-world deployments.
- Owner settings to manage member roles.
- Autocomplete or search for org selection once dataset grows.
