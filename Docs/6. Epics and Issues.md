This file converts the MVP plan and recent decisions into actionable epics and issues. Use these IDs in your tracker (GitHub Projects, Linear, etc.). All timelines assume soft multi-tenancy (org_id scoping) and minimal third-party dependencies; Turnstile or alternatives can be revisited when we tackle the public intake hardening epic.

---

# Epic EP-CORE-PLATFORM — Soft Tenancy & RBAC Foundation

Focus: organization scoping, user lifecycle, permissions, audit baseline.

* **ISSUE EP-CORE-001 — Database tenancy plumbing**
  * Add `organization_id` columns + foreign keys to core tables (users pivot, channels, reports, cases, attachments, audit logs, deadlines, tokens).
  * Create `ScopedByOrganization` trait for models and apply global scopes.
  * Update seeders/factories for multi-org data.
* **ISSUE EP-CORE-002 — Organization & role management APIs**
  * Build OrganizationController (show/update), MemberInvitationController, role assignment endpoints (owner/admin).
  * Wire Sanctum SPA auth + organization switcher endpoint.
  * Implement policies using `spatie/laravel-permission`.
* **ISSUE EP-CORE-003 — Audit & activity logging**
  * Create `audit_logs` migration/model, event listeners for create/update/delete.
  * Expose per-org audit feed API and basic Inertia table.
  * Mask encrypted fields before logging diffs.
* **ISSUE EP-CORE-004 — Feature manifest service**
  * Persist plan tiers + feature flags on Organization.
  * Add `/api/feature-manifest` endpoint returning enabled modules & defaults.
  * Front end: global store hydrate + guard routes/components.

---

# Epic EP-WB-INTAKE — Encrypted Public Reporting

Focus: channel management, intake form, encryption, captcha placeholder.

* **ISSUE EP-WB-001 — Channel CRUD & public descriptor**
  * Channel migration + model with `public_key`, `settings`, `status`.
  * Internal UI to create/manage channels; validations for unique slug.
  * Public endpoint `/public/channels/{slug}` returns metadata + encryption params.
* **ISSUE EP-WB-002 — Browser crypto & submission flow**
  * React intake page: collect report, attachments, optional contact, render crypto helpers.
  * Implement WebCrypto helpers to generate symmetric key, encrypt payload, wrap with channel key.
  * Submission endpoint validates payload, stores ciphertext, enqueues case creation job.
* **ISSUE EP-WB-003 — Anti-abuse safeguards (baseline)**
  * Add rate limiter (`throttle:public-intake`, e.g., 10/min/IP) with env-configured values.
  * Server-side captcha check scaffold: verify request only if `feature('captcha')` true. (Placeholder for Turnstile or alternative.)
  * Centralize validation errors for intake (size, mime, count).
* **ISSUE EP-WB-004 — Reporter acknowledgement**
  * Generate reference code and optional follow-up prompt after submission.
  * Persist metadata for SLA engine (created timestamps, channel).
  * Display confirmation page and optional email template (if reporter provides contact).

---

# Epic EP-WB-CASE — Case Management & Collaboration

Focus: agent workflows, messaging, attachments, timeline.

* **ISSUE EP-WB-101 — Case creation & lifecycle rules**
  * `cases` migration + model with status, priority, due dates, tags.
  * Listener creates case per report; default status `new`, optional auto-assign rule stub.
  * Policy matrix enforcing which roles can update status, priority, assignee.
* **ISSUE EP-WB-102 — Inbox & filters UI**
  * Inertia page listing cases with filters (status, assignee, priority, channel).
  * API endpoints for pagination/sorting respecting org scope.
  * Persist user preferences (e.g., saved views) in DB/local storage.
* **ISSUE EP-WB-103 — Encrypted messaging & attachments**
  * `case_messages` + `attachments` migrations/models.
  * Front end component for message thread with client-side encryption before POST.
  * File upload workflow using temporary credentials or POST endpoint storing ciphertext paths; short-lived download URLs.
* **ISSUE EP-WB-104 — Timeline & audit surfacing**
  * `case_events` table for timeline entries.
  * Listener hooks to add events on status change, assignment, message, attachment.
  * UI timeline component summarizing events with metadata-only payloads.

---

# Epic EP-SLA-COMPLIANCE — Deadlines, Reminders, Regulatory Alignment

Focus: enforce 7-day acknowledgment, 3-month feedback, internal triage targets.

* **ISSUE EP-SLA-001 — Deadlines data model & scheduler hooks**
  * Create `deadlines` table with type (`ack`, `triage`, `assign`, `feedback`), `due_at`, `met_at`, status.
  * Observer creates deadlines when report/case transitions happen.
  * Artisan command + scheduled job to evaluate deadlines nightly.
* **ISSUE EP-SLA-002 — Reminder & escalation notifications**
  * Mail notifications to assignees/owners as deadlines approach (e.g., 80% SLA).
  * Breach alert sends metadata only, links to case.
  * Weekly digest summarizing upcoming/overdue items.
* **ISSUE EP-SLA-003 — Dashboard cards & reporting**
  * API endpoints returning counts by status, owner, channel, severity.
  * Inertia dashboard with SLA widgets (acknowledgment compliance, average response times).
  * Export endpoint (CSV/JSON) for compliance evidence.

---

# Epic EP-REPORTER-PORTAL — Follow-Up Experience

Focus: secure follow-up link, sliding expiration, reporter messaging.

* **ISSUE EP-RPT-001 — Token model & middleware**
  * Create `reporter_portal_tokens` table (selector/verifier hash, last_seen_at, expires_at, revoked_at).
  * Generate token on report submission when reporter requests follow-up.
  * Middleware validating token, extending expiry on activity (default 6-month inactivity).
* **ISSUE EP-RPT-002 — Reporter portal UI & messaging**
  * Public Inertia (or standalone React) page to authenticate via token, view case metadata.
  * Allow reporter to send new encrypted messages; re-use WebCrypto to decrypt queue.
  * Display inactivity warning at 30-day remaining threshold.
* **ISSUE EP-RPT-003 — Admin controls for portal access**
  * Agent ability to revoke/extend reporter tokens per case.
  * Audit entries when tokens are issued, extended, revoked.
  * Optional manual reminder email (doorstep) with secure link, no plaintext.

---

# Epic EP-COMPLIANCE-GDPR — Data Governance & Breach Handling

Focus: GDPR Art.33 hooks, exports, deletion, retention.

* **ISSUE EP-GDPR-001 — Breach log & workflow**
  * `breach_logs` table capturing incident facts, detection time, notification decisions.
  * UI form for admins to record incidents; export PDF/CSV for authorities.
  * Reminder job for 72-hour notification window monitoring flagged cases.
* **ISSUE EP-GDPR-002 — Data export & deletion requests**
  * API + UI for admins to export case metadata, audit logs, encrypted blobs (no decryption).
  * Soft-delete workflow honoring retention policy; background job to purge after retention period.
  * Confirmation screens + emails for admins when exports/deletions complete.
* **ISSUE EP-GDPR-003 — Retention & lifecycle policies**
  * Org-level settings for data retention (default 18 months) stored in `organization_settings`.
  * Scheduler that marks cases/attachments for purge and queues deletion jobs.
  * Logging of all retention actions for audit evidence.

---

# Epic EP-OPS-FOUNDATION — Queues, Monitoring, Backups

Focus: operational readiness on single VPS with Docker.

* **ISSUE EP-OPS-001 — Queue & scheduler services**
  * Configure Horizon (or queue:work supervisor) container/service.
  * Add scheduler container executing `artisan schedule:run` every minute.
  * Health endpoints reporting queue/worker status.
* **ISSUE EP-OPS-002 — Backup automation**
  * Scripted daily `pg_dump` to MinIO/S3-compatible storage with retention rules.
  * Verification job checks integrity weekly; alert on failures.
  * Document restoration steps in README/Docs.
* **ISSUE EP-OPS-003 — Observability baseline**
  * Structured logging (request ID, org ID) and log rotation.
  * Health check route for Uptime Kuma, includes DB and cache pings.
  * Optional containerized monitoring stack (Promtail/Loki/Grafana) flagged as stretch goal.

---

# Epic EP-FRONTEND-UX — Inertia React Experience

Focus: SPA consistency, state management, accessibility.

* **ISSUE EP-FE-001 — Global app shell & organization context**
  * Implement layout with organization switcher, feature guards, user menu.
  * Store manifest, SLA config, and crypto keys in global state (Zustand or Redux toolkit).
  * Handle idle timeout and logout flows gracefully.
* **ISSUE EP-FE-002 — Accessibility & localization**
  * Apply WCAG AA basics across forms, tables, dialogs.
  * Set up i18n scaffolding (react-intl or i18next) with English + two EU languages for public intake.
  * Add automated lint/test step for accessibility regressions (axe tests or eslint-plugin-jsx-a11y).
* **ISSUE EP-FE-003 — Reporter autosave & draft handling**
  * LocalStorage draft saving for public intake form without leaking plaintext to server.
  * Resume flow prompts user to restore draft when revisiting link.
  * Clear drafts after successful submission or manual reset.

---

# Epic EP-SEC-HARDENING — Security & Hardening Enhancements

Focus: headers, rate limits, secrets, future-proof for third-party services.

* **ISSUE EP-SEC-001 — Application security headers**
  * Configure caddy/nginx for CSP, HSTS, frame/options, referrer policy.
  * Add middleware for response headers in Laravel (API + web) to enforce defaults.
  * Document CSP allowances for Inertia + Vite assets.
* **ISSUE EP-SEC-002 — Rate limiting policies**
  * Implement per-endpoint rate limiters (public intake, reporter portal, auth endpoints).
  * Logging + monitoring for throttle hits; expose metrics to dashboard.
  * Add configurable env values and feature flags around rate limit tiers.
* **ISSUE EP-SEC-003 — Secrets & key management**
  * Document process for generating channel public keys and storing private keys client-side.
  * Add helper commands to rotate keys, revoke reporter tokens, and audit key usage.
  * Prepare abstraction layer for future Turnstile integration (feature flag, config placeholders) without committing to provider today.

---

# Notes & Next Steps

1. Prioritize EP-CORE-PLATFORM → EP-WB-INTAKE → EP-WB-CASE to unlock end-to-end reporting flow.
2. Capture dependencies in tracker: core tenancy must land before intake/case modules; SLA engine depends on case creation.
3. When ready to integrate CAPTCHA, revisit EP-SEC-003 to choose provider or OSS library; keep server-side verification modular.
4. Update Docs/5 with progress references or link this file from README so newcomers understand roadmap.
