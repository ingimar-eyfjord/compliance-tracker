# Pages Overview

This document maps the core Inertia pages/routes to the data they should surface, which models back them, and the intended user interactions. Sections are grouped first by global structure, then by feature plan tiers so we can see which modules appear per plan.

---

## Global Layout & Navigation

- **LayoutShell (authenticated)**
  - Data: `auth.user`, `auth.tenant`, `auth.memberships` (shared via `HandleInertiaRequests`).
  - UI: App header with tenant name, role badge, org switcher dropdown (opens `orgs/select` modal), user menu (profile, settings, logout), notifications icon placeholder.
  - Interactions: Switch organization (posts to `/orgs/switch`), open settings routes, quick links to main modules.
- **Sidebar Navigation**
  - Data: Tenant feature manifest (`auth.tenant.feature_manifest`).
  - UI: Collapsible sections (Dashboard, Whistleblowing, Risk, Compliance, Settings).
  - Interactions: Highlight active route, hide items if feature disabled or user lacks role.

---

## Core Plan (All tenants)

### Dashboard (`/dashboard`)
- Models: `CaseFile`, `Report`, `Deadline`, `OrganizationMembership`.
- Data:
  - Case summary cards: counts by `CaseStatus` (open, triage, in_progress, resolved).
  - SLA widgets: deadlines met/breached from `Deadline` per type (ACK, feedback).
  - Recent activity feed: latest `CaseEvent` + `AuditLog` (actors, timestamps).
  - Assignment list: `CaseFile` assigned to current user.
- UI: Cards grid + tables with filters.
- Interactions: Clicking a case opens Case Detail; filters by channel, status, assignee.

### Case Inbox (`/cases`)
- Models: `CaseFile`, `Channel`, `User`, `Deadline`.
- Data: Paginated list with columns (ID, channel, reporter metadata, status, priority, SLA state).
- UI: Filter bar (status, assignee, priority, channel), search by reference code.
- Interactions: Bulk actions (assign, change status) for users with manager/admin roles; click row to open Case Detail.

### Case Detail (`/cases/{id}`)
- Models: `CaseFile`, `Report`, `CaseMessage`, `Attachment`, `Deadline`, `CaseEvent`, `ReporterPortalToken`.
- Data:
  - Metadata header (status, priority, assignee, deadlines).
  - Conversation thread (messages, attachments, sender type).
  - Timeline tab (events and audit entries).
  - Reporter portal status (tokens, last seen).
- UI: Two-column layout (left: thread, right: metadata/actions).
- Interactions:
  - Update status/priority/assignee (policy-guarded).
  - Post new message (agent/reporter type toggles with encryption handled client-side).
  - Upload attachments (drag/drop to message composer).
  - Manage deadlines (set due dates, mark acknowledged).

### Channels (`/channels`)
- Models: `Channel`, `Report`, `FeatureFlag`.
- Data: List of intake channels with slug, status, submission counts.
- UI: Table + detail drawer for settings (languages, captcha toggle, public key).
- Interactions: Create/edit channel (name, slug, settings), archive/unarchive, view submission stats.

### Settings
- **Profile (`/settings/profile`)**
  - Models: `User`.
  - Data: Personal info (name, email, last login).
  - Interactions: Update profile data, view memberships list.
- **Password (`/settings/password`)**
  - Models: `User`.
  - Interactions: Change password (Fortify handler).
- **Two-Factor (`/settings/two-factor`)**
  - Models: `User`.
  - Data: 2FA status, recovery codes.
  - Interactions: Enable/disable, regenerate codes.
- **Organization Settings (`/settings/organization`)** *(new)*
  - Models: `Organization`, `FeatureFlag`, `OrganizationMembership`.
  - Data: Org name, slug, plan tier, feature toggles, member list.
  - Interactions: Update org info, toggle features (if owner), invite/remove members, update roles.

---

## Whistleblowing Module (Core)

### Reports List (`/reports`)
- Models: `Report`, `Channel`, `CaseFile`.
- Data: Raw submissions (reference code, channel, created via).
- UI: Table with filters by channel, status; option to view encrypted metadata.
- Interactions: Link to related case, mark as acknowledged, export chosen reports.

### Reporter Portal View (`/reports/{id}/portal`) *(internal preview)*
- Models: `ReporterPortalToken`, `CaseMessage`.
- Data: Token status, last activity, link previews.
- UI: Tab showing what the anonymous reporter sees.
- Interactions: Regenerate token, revoke access, copy portal link.

---

## Risk Lite (Plan: Pro & above)

### Risk Register (`/risk`)
- Models: (Future) `Risk`, `Control`, `CaseFile` (link evidence).
- Data: List of risks (title, owner, inherent/residual scores, status).
- UI: Table + chart summarizing risk heatmap.
- Interactions: Create/edit risk, assign owners, attach cases as evidence.

### Risk Detail (`/risk/{id}`)
- Models: `Risk`, `CaseFile`, `Deadline`.
- Data: Risk description, controls, assessment history.
- UI: Tabs for Overview, Mitigations, Evidence.
- Interactions: Update scoring, add mitigations (future), link cases, assign follow-up deadlines.

---

## Compliance & Breach Management (Plan: Pro & above)

### Breach Log (`/compliance/breaches`)
- Models: `BreachLog`, `CaseFile`.
- Data: List of incidents (detected, notified, authority flag, impact summary).
- UI: Table with filters by status, date, notified flag.
- Interactions: Log new breach (tie to case), mark authority notified, export report (CSV/PDF).

### Compliance Dashboard (`/compliance/overview`)
- Models: `Deadline`, `AuditLog`, `FeatureFlag`.
- Data: SLA compliance charts, audit trail quick stats, feature enablement summary.
- UI: Widgets showing compliance KPIs; timeline of key audit entries.
- Interactions: Date range filter, link to exported audit logs.

---

## Admin & Owner Utilities (Plan: Enterprise additions)

### User Management (`/settings/members`)
- Models: `OrganizationMembership`, `User`.
- Data: Member list with role badges, invitation status.
- UI: Cards or table with actions.
- Interactions: Invite user (email), resend, change role, disable user, impersonate (owner only).

### Feature Toggles (`/settings/features`)
- Models: `FeatureFlag`.
- Data: List of features with status, expiry.
- UI: Toggle switches with metadata.
- Interactions: Enable trials, set expiry, view change history (via `AuditLog`).

### Audit Exports (`/settings/audit`)
- Models: `AuditLog`, `CaseEvent`.
- Data: Filters (date range, resource type, actor).
- UI: Table + export buttons.
- Interactions: Download CSV/JSON, view detail modal per entry.

---

## Public Pages

### Welcome (`/`)
- UI: Marketing snippet with login/register links, feature cards.
- Interactions: CTA to register or login.

### Public Channel Intake (`/public/channels/{slug}`)
- Models: `Channel`.
- Data: Channel metadata, localized form schema, encryption keys.
- UI: Intake form (text, attachments, language selector).
- Interactions: WebCrypto encryption on submit, optional reporter contact, captcha (future). After submission, show reference code and portal option.

### Reporter Portal (`/portal/{selector}`) *(future)*
- Models: `ReporterPortalToken`, `CaseMessage`.
- Data: Token validation info, case metadata.
- UI: Login with token code, conversation view.
- Interactions: Send encrypted messages, upload attachments, view deadlines, see inactivity warning.

---

## Cross-Cutting Components

- **Org Switcher Modal** (triggered from header)
  - Data: `auth.memberships`.
  - UI: List of organizations with role badges and last accessed time.
  - Interactions: Selecting posts to `/orgs/switch`.
- **Notifications Drawer**
  - Models: `Deadline`, `CaseMessage` (unread), `BreachLog`.
  - Data: Combined list of alerts.
  - UI: Drawer with grouped notifications.
  - Interactions: Mark as read, navigate to related page.
- **Feature Flag Guards**
  - Wrap routes/components; check `auth.tenant.feature_manifest` and role before rendering.

---

## Implementation Notes

- Every page hitting protected data must rely on the `tenant` middleware to ensure `organization_id` scoping via `ScopedByOrganization`.
- When building queries, preload relationships necessary for the UI to reduce N+1 issues (e.g., `CaseFile::with(['report.channel', 'assignee', 'deadlines'])` for the inbox).
- Front-end interactions should use Inertia form helpers for request state & validation messages, matching existing patterns in auth pages.
